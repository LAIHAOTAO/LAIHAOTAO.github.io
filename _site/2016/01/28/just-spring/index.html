<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>再探spring+mbybaits - Eric的博客 | Eric Blog</title>

    <link rel="canonical" href="http://laihaotao.github.io/2016/01/28/just-spring/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Eric Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/contact/">Contact</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/home-bg.jpg" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#java_ee" title="java_ee">java_ee</a>
                        
                    </div>
                    <h1>再探spring+mbybaits</h1>
                    
                    
                    <h2 class="subheading">A demo about spring and spring+mybatis</h2>
                    
                    <span class="meta">Posted by Eric Blog on January 28, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

				<p><strong>本文是作者原创文章，欢迎转载，请注明出处 from:@<a href="http://laihaotao.github.io">Eric_Lai</a></strong></p>

<p>这几天一直都在做spring+mybaits的整合项目，但是其中遇到很多问题。所以现在开始重新学习一下spring，重最简单的开始，下面演示一个demo。</p>

<h1 id="section">工程目录</h1>
<p>本次demo的工程目录如下：
<img src="/images/justspring_proStru.JPG" alt="工程目录图" /></p>

<p>注解：其中涂了红色的请忽略，是做其他作用的。包名为：justspring，下面有两个包分别是dao和service。dao用于模拟以后的数据库操作，service，顾名思义是服务层。
这两个包当中各有两个文件，一个是接口（interface）一个是接口的实现（interfaceImpl）。</p>

<h1 id="version-10">详细代码（version 1.0）</h1>
<p>## dao（数据持久层）</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//dao.java 文件名(下同)</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Dao</span> <span class="o">{</span>
	<span class="n">String</span> <span class="n">sayHello</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//daoImpl.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DaoImpl</span> <span class="kd">implements</span> <span class="n">Dao</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">sayHello</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello by dao"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>以上是dao层的代码，因为这是一个demo，所以每个文件只有一个方法用于示范。在真实的环境当中，dao层应该是和数据库打交道的，dao只提供接口而具体的实现可以通过mybatis的sql映射来实现，或者自己编写数据库的操作语句。在这里，因为是demo所以采用了后者，并且没有写数据库操作语句。</p>

<h2 id="service">service（服务层）</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//service.java </span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Service</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">sayHello</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">otherService</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//serviceImpl.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">justspring.dao.Dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceImpl</span> <span class="kd">implements</span> <span class="n">Service</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Dao</span> <span class="n">dao</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">setDao</span><span class="o">(</span><span class="n">Dao</span> <span class="n">dao</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dao</span> <span class="o">=</span> <span class="n">dao</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">sayHello</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dao</span><span class="o">.</span><span class="na">sayHello</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">otherService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"other service"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>服务，是用来承接控制层和数据层的，数据层取得的数据要在这里进行各种逻辑操作。将service细分为两小层：</p>

<ul>
  <li>service 服务接口层</li>
  <li>serviceImpl 服务实现层</li>
</ul>

<p>服务接口层很简单，就是将提供的服务逐一的列出来，不管具体的实现。服务实现层，则是负责实现每一个服务，这样有利于后期的维护和升级。一般来说，我们从数据库查到的信息都是要拿来进行各种逻辑操作的，这个操作的场所正是服务实现层。所以，等下会在服务实现层里面由spring注入dao接口。既然如此为什么服务实现层不直接实现dao接口就好了呢？因为，真正的系统里面还会有一些不依靠数据库或者不同数据库的操作，所以其他服务需要在服务接口层进行声明。</p>

<p>在这里，最重要的就是这个serviceImpl了。它负责实现服务，我们可以看到这里面有一个Dao的对象，但是奇怪的是我们并没有给它new任何的实例。如果你对spring有一点了解的话就会知道，这里将会使用spring的依赖注入（Ioc）来实现了。后面的spring的配置文件里会有说明。</p>

<p>这里有两个方法，其中的sayHello方法是使用了dao的方法，otherService则可以想象成是一些不需要数据库的服务。</p>

<h2 id="spring">spring配置文件</h2>
<p>相信熟悉spring的都会知道，spring需要有一个配置文件，主要就是用来配置bean的。所以，这个文件很重要，随着spring的发展，越来越多简便的配置方法也出来了，很容易把人搞晕，我这次重新研究的重点就是想找到最简便最清晰的配置方法。但是，我还没研究出来，所以这里采用最原始的配置方法来演示。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>//spring1.xml 这个名字大家可以随便起
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="nt">&gt;</span>

       <span class="c">&lt;!--创建一个一个名字（可以用name或者id来表示，唯一标识，不可重复）为dao的bean，class表示它的类（必须是类，不可以是接口或者抽象类）--&gt;</span>
       <span class="c">&lt;!--这个主要是用来等着被下面的bean使用的--&gt;</span>
       <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dao"</span> <span class="na">class=</span><span class="s">"justspring.dao.DaoImpl"</span><span class="nt">/&gt;</span>

       <span class="c">&lt;!--创建一个名字为service，类型是ServiceImpl的bean，并且将这个bean注入到ServiceImpl.java的成员变量dao当中--&gt;</span>
       <span class="c">&lt;!--property 当中的name是成员变量的名字（需要保持一致），ref是指注入的是上面创建的bean--&gt;</span>
       <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"service"</span> <span class="na">class=</span><span class="s">"justspring.service.ServiceImpl"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dao"</span> <span class="na">ref=</span><span class="s">"dao"</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre>
</div>

<h2 id="section-1">测试</h2>
<p>做到这里就基本是万事具备了，我们来测试一下是否真的成功了。为了不写main函数那套这里用了Junit4来进行，需要在maven下添加一下依赖包。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>testJustSpring<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">justspring.service.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testJustSpring</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">test</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">//引入spring的配置文件获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"spring1.xml"</span><span class="o">);</span>
		<span class="c1">//通过上下文和bean的名字获取service实例，就是刚才在配置文件下配置的第二个</span>
		<span class="c1">//其实这里也可以通过依赖注入来实现，不过需要写setter代码不太好看        </span>
		<span class="n">Service</span> <span class="n">service</span> <span class="o">=</span> <span class="o">(</span><span class="n">Service</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"service"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">sayHello</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>通过上面的代码，我们可以得到的结果如下：</p>

<blockquote>
  <p>hello by dao</p>
</blockquote>

<h2 id="spring-1">简化spring配置过程</h2>
<p>通过上面的配置，成功地得到了想要的结果。但是，如果bean很多的时候，我们都需要逐一的去配置就会显得非常的麻烦。spring团队也一直致力于简化.xml的配置步骤，这里简述一下如何使用注解来简化配置。</p>

<p>要想使用注解进行xml配置，需要在xml当中添加以下代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;context:annotation-config/&gt;</span>
<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"justspring.service,justspring.dao"</span><span class="nt">/&gt;</span>
</code></pre>
</div>
<p>以上第一行是开启注解，第二行是扫描注解包。如果有第二行代码，第一行可以省略。</p>

<p>对于不同的层，spring提供了不同的注解。详细的情况如下所示：</p>

<blockquote>
  <ul>
    <li>dao层使用 @Repository，可以在其后添加(““)来指定bean的名字（即name或者id）</li>
    <li>service层使用 @Service，可以在其后添加(““)来指定bean的名字（即name或者id）</li>
    <li>controller层使用 @Controller，可以在其后添加(““)来指定bean的名字（即name或者id）</li>
    <li>其他情况下可以使用 @Component，可以在其后添加(““)来指定bean的名字（即name或者id）</li>
  </ul>
</blockquote>

<p>注意，以上注解都是在接口的实现类进行。并且，如果没有指定名字，系统会默认起名，规则是：取类名，将第一个字母转换为小写。</p>

<p>使用以上的方法，我们可以完成将bean在xml的注册。但是，如果在某一类当中，我们需要使用bean时，怎么将xml当中的bean注入到类当中呢？这里要涉及到bean的自动装配策略。相关的注释主要有@Resource和@Autowired。这里不详细讲述他们的区别，需要看详细介绍了可以看这篇<a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-spring-iocannt/">文章</a>，本文使用@Resource进行。回到代码当中，将上面的代码做出如下的修改。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//DaoImpl.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="nd">@Repository</span><span class="o">(</span><span class="s">"dao"</span><span class="o">)</span> <span class="c1">//添加了这行代码</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DaoImpl</span> <span class="kd">implements</span> <span class="n">Dao</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">sayHello</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello by dao"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//ServiceImpl.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">justspring.dao.Dao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.annotation.Resource</span><span class="o">;</span>

<span class="c1">//因为这个工程里有Service类，为了不发生歧义，使用包名+类名</span>
<span class="nd">@org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">stereotype</span><span class="o">.</span><span class="na">Service</span><span class="o">(</span><span class="s">"service"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceImpl</span> <span class="kd">implements</span> <span class="n">Service</span> <span class="o">{</span>

    <span class="nd">@Resource</span> <span class="c1">//添加了这个注释，将上面的dao注入到这里</span>
    <span class="kd">private</span> <span class="n">Dao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">sayHello</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dao</span><span class="o">.</span><span class="na">sayHello</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">otherService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"other service"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>有了上面两个代码文件，我们的xml就解放出来了。不需要再进行任何的bean注册了，现在的xml应该如下所示：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="nt">&gt;</span>

       <span class="nt">&lt;context:annotation-config/&gt;</span>
       <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"justspring.service,justspring.dao"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre>
</div>

<p>xml文件一下子干净了很多，省掉了配置的麻烦。测试类的代码不作任何的变化，运行后可以得到与之前一样的结果。测试类当中的service还是要通过getBean来实现的，我尝试着用@Resource像注入dao那样的方法来做，但是并没有能够成功。报错空指针，这里接下来还需要认真的研究一下。</p>

<h1 id="version-20">详细代码（version 2.0）</h1>
<p>前面已经得到了一个完整的spring工程，但是dao部分关于数据库的还没有实现，下面来完成怎么连接数据库，并且从数据库里面获取到数据的操作。首先需要在maven下添加需要的依赖包，这里不一一列举了，可以参看我这个系列的第一篇<a href="http://laihaotao.github.io/2015/11/13/spring-myabtis/">文章</a>。</p>

<h2 id="mybatis-spring">Mybatis-Spring</h2>
<p>Mybatis，是支持定制化 SQL、存储过程以及高级映射的优秀的持久层框架。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p>

<blockquote>
  <p>Mybatis有一个中文的说明文档，需要可以点击<a href="http://www.mybatis.org/mybatis-3/zh/">这里</a>查看</p>
</blockquote>

<p>由于我们是在spring的框架下使用mybait，所以除了配置mybatis外，还需要将它和spring框架结合在一起。方便的是，已经存在无缝连接它们的库了，那就是Mybaits-Spring。</p>

<blockquote>
  <p>Mybatis-Spring有一个中文的说明文档，需要可以点击<a href="http://www.mybatis.org/spring/zh/">这里</a>查看</p>

  <p>注意，中文版不够详细，有能力还是请阅读英文版</p>
</blockquote>

<p>通过这个文档，总结一下使用的方法。</p>

<h3 id="section-2">安装</h3>
<p>使用整个模块前需要引入必要的jar包，或者添加依赖文件.
如果使用的是maven，在pom.xml当中添加如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>mybatis-spring<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>x.x.x<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>
<p>### 开始
要和spring一起使用mybatis，需要在spring的上下文当中定义至少两样东西。分别是：</p>

<ul>
  <li>一个SqlSessionFactory</li>
  <li>至少一个数据映射器类</li>
</ul>

<h4 id="sqlsessionfactory">配置SqlSessionFactory</h4>
<p>其中，第一点很容易配置，先把它干掉。直接在spring的上下文配置就可以了，注意，整合后，不需要单独的mybatis配置文件，全部的配置内容都可以在spring的上下文当中进行。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>//spring1.xml 在上面已有的基础上添加

//数据源配置，需要根据个人情况填写
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbcp.BasicDataSource"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/数据库名"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"用户名"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"密码"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

//SqlSessionFactory配置，注意此处有大坑（如果你使用Intellij这个ide的话请看后面的填坑指南）
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"sqlSessionFactory"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.SqlSessionFactoryBean"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mapperLocations"</span> <span class="na">value=</span><span class="s">"classpath:mapper/*.xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre>
</div>

<p>注意：上面的的文件不能照着填，需要将路径理清楚，如果你自己在尝试着写的话，请把路径换成你自己的。这里使用的是mysql数据库，如果不是请按照实际情况填写。Intellij编译工程的时候，会按照目录的种类进行编译，xml文件在src的源码目录下的话不会编译到target里面，需要单独进行设置。</p>

<h4 id="section-3">配置数据映射器类</h4>
<p>配置数据映射器的方法有很多，先简要的叙述一下：</p>

<blockquote>
  <p>官方说明文档在<a href="http://www.mybatis.org/spring/mappers.html">这里</a>（这里不要去看中文的翻译版，不单止内容缺少，而且讲得非常不清楚）</p>

  <p>总结一下来说就是两种方法：
- 利用xml来进行显示的逐一配置（如果mapper很多的话就会很麻烦）
- 利用mybatis-spring提供的自动扫描机制（就像spring当中扫描dao和service组件那样）</p>
</blockquote>

<p>有简单的方法使用，相信没有人希望用难的方法，所以这里使用上述的第二种方法进行，在spring1.xml（即spring的配置文件）当中添加几句代码可以：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>//spring1.xml 现在我的spring1.xml看起来是这样的

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mybatis="http://mybatis.org/schema/mybatis-spring"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://mybatis.org/schema/mybatis-spring
       http://mybatis.org/schema/mybatis-spring.xsd"&gt;

		//添加了这一句和多引用了一个命名空间，请和上面的文件对比着看
       	&lt;mybatis:scan base-package="justspring.dao" /&gt;

       	...省略相同的代码

&lt;/beans&gt;
</code></pre>
</div>

<h4 id="section-4">添加数据库查询操作以及包装服务层代码</h4>
<p>配置方面现在就都做好了，需要添加一些数据库的操作代码（写在xml配置文件上），另外在dao和service提供一些接口并实现它。在dao真正操作数据库的时候不需要我们自己写实现类，按照上面的配置，保证xml的名字和接口类的名字对应一致，框架会替我们做好实现。要实现操作数据库，首先要有数据表，我们这里建了一个用来测试，如下：</p>

<blockquote>
  <p>括号表示存在表里的数据</p>

  <p>表名：person</p>

  <p>字段1：LOG_NM（”管理员0”）</p>

  <p>字段2：LOG_PW（”123456”）</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//Dao.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Param</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="nd">@Repository</span> <span class="c1">//没有实现类DaoImpl，所以将这个注解放在了这里</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Dao</span> <span class="o">{</span>
<span class="c1">//    @Select("SELECT LOG_PW FROM person WHERE LOG_NM = #{name}")</span>
<span class="c1">//通过@Select注释也可以不用写xml直接进行数据库操作，但是在比较复杂的查询情况下还是需要xml的（官方的说法），所以这里还是使用xml的方法</span>
    <span class="n">String</span> <span class="n">getPwByUserNm</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="c1">//@Param是一个注解，表示传进去的参数名字，在xml当中通过@Param括号里面的名字，可以获取到传进去的参数</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//Service.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Service</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">getPwByUserNm</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//ServciceImpl.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">justspring.dao.Dao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.ibatis.annotations.Param</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.Resource</span><span class="o">;</span>

<span class="nd">@org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">stereotype</span><span class="o">.</span><span class="na">Service</span><span class="o">(</span><span class="s">"service"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceImpl</span> <span class="kd">implements</span> <span class="n">Service</span> <span class="o">{</span>

	<span class="c1">//同上，注入一个dao</span>
    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="n">Dao</span> <span class="n">dao</span><span class="o">;</span>

	<span class="c1">//实现通过用户名获取密码的服务</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">getPwByUserNm</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">getPwByUserNm</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>//Dao.xml

<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</span>
//命名空间必须指向接口类
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"justspring.dao.Dao"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"getPwByUserNm"</span> <span class="na">resultType=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
        SELECT LOG_PW FROM person WHERE LOG_NM = #{name}
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//testJustSpring.java</span>

<span class="kn">package</span> <span class="n">justspring</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">justspring.service.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.Resource</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">testJustSpring</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"spring1.xml"</span><span class="o">);</span>
        <span class="n">Service</span> <span class="n">service</span> <span class="o">=</span> <span class="o">(</span><span class="n">Service</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"service"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"管理员0"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getPwByUserNm</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>
<p>以上，代码已经完全展示出来。但是前面说的大坑还没有解决，为解决它先看一下正确的文件结构应该这样设置：</p>

<p><img src="/images/justspring_proStr2.JPG" alt="新文件结构" /></p>

<p>请将文件结构调整如上！</p>

<p>请将文件结构调整如上！</p>

<p>请将文件结构调整如上！</p>

<p>重要的事情说三遍，test的包可以不调整，没有影响。并且点击工程根目录，按下F12打开模块设置，将resources目录设置为resources root类型，点击apply。重新编译一次，应该就能够在.targe下看到Dao.xml文件了。详情请看<a href="http://blog.csdn.net/XiWenRen/article/details/49101605">这里</a>，非常感谢解决方案。</p>



                <hr>

                
                <!-- 多说 Share start -->
                </style>
                <div class="ds-share"
                    style="text-align: right"
                    data-thread-key="/2016/01/28/just-spring"
                    data-title="再探spring+mbybaits"
                    data-url="http://laihaotao.github.io/2016/01/28/just-spring/"
                    data-images="http://laihaotao.github.io/img/home-bg.jpg"
                    data-content="本文是作者原创文章，欢迎转载，请注明出处 from:@Eric_Lai

这几天一直都在做spring+mybaits的整合项目，但是其中遇到很多问题。所... | Eric的博客 | Eric Blog " >
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">
                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- 多说 Share end-->
                


                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2015/11/13/spring-myabtis/" data-toggle="tooltip" data-placement="top" title="初探Spring+myBatis">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2016/02/24/uk-apply/" data-toggle="tooltip" data-placement="top" title="我的英国授课硕士申请经历">Next Post &rarr;</a>
                    </li>
                    
                </ul>


                
                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread"
                        data-thread-key="/2016/01/28/just-spring"
                        data-title="再探spring+mbybaits"
                        data-url="http://laihaotao.github.io/2016/01/28/just-spring/" >
                    </div>
                </div>
                <!-- 多说评论框 end -->
                

                

            </div>

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
                				<a href="/tags/#java" title="java" rel="4">
                                    java
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#数据库" title="数据库" rel="2">
                                    数据库
                                </a>
                            
        				
                            
                				<a href="/tags/#java_ee" title="java_ee" rel="3">
                                    java_ee
                                </a>
                            
        				
                            
                				<a href="/tags/#Android" title="Android" rel="6">
                                    Android
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#project" title="project" rel="2">
                                    project
                                </a>
                            
        				
                            
                				<a href="/tags/#algorithm" title="algorithm" rel="6">
                                    algorithm
                                </a>
                            
        				
                            
                				<a href="/tags/#留学" title="留学" rel="2">
                                    留学
                                </a>
                            
        				
                            
                				<a href="/tags/#毕业设计" title="毕业设计" rel="5">
                                    毕业设计
                                </a>
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="http://victorzhong.github.io">Victor Zhong</a></li>
                    
                        <li><a href="http://effyli.github.io">Effy Li</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>


<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    // dynamic User by Hux
    var _user = 'laihaotao';

    // duoshuo comment query.
    var duoshuoQuery = {short_name: _user };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'never',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/laihaotao">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/eric0325">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/LAIHAOTAO">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Eric Blog 2016 | 
                    Theme by <a href="http://huangxuan.me">Hux</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
