<!DOCTYPE html>
<html>
<head>
    <!--
    **
    * 此文档的原作者是PIZn，邮箱pizner@gmail.com
    *
    * 在他的基础上由我做了二次做了修改
    * 本人Eric_Lai,邮箱qq584863350@gmail.com
    * 
    **
    -->
    <meta charset="utf-8" />
    <title>使用jsp的JSTL标准标签配合数据库连接池与数据库进行交互 | Eric_Lai's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="Eric" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/css/pygments.css" type="text/css">
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <!--[if lt IE 9]>
    <script src="/js/html5.js" type="text/javascript"></script>
    <![endif]-->
</head>
<body id="default">
<div id="head-line"></div>
<div id="content">
    <header id="head">
        <div id="logo">
            <h1>Eric</h1>
            <h2>Be better than yesterday</h2>
        </div>
        <nav id="nav">
            <ul>
                <li class="fn-clear"><a href="" rel="nofollow" class="action"><i class="icon-home"></i> Home</a></li>
                <li class="fn-clear"><a href="/archives.html"><i class="icon-list-ul"></i> Archives</a></li>
                <li class="fn-clear"><a href="/about_me.html"><i class="icon-info-sign"></i> About</a></li>
                <li class="fn-clear"><a href="/contact.html"><i class="icon-envelope-alt"></i> Contact</a></li>
                <li style="text-align: center"><img src="/images/aboutme.jpg"></li>
            </ul>
        </nav>
    </header>
    <section id="contain">
        <header id="begin">
            <span>2015-07-19 00:00:00 +0800</span>
        </header>
		<article class="post">
    <h1 class="post-title">使用jsp的JSTL标准标签配合数据库连接池与数据库进行交互</h1>
    <h1 id="前言">前言</h1>

<p>昨天因为有事情，没有时间来做实验。今天接着前面的来做了一下，前面已经完成了数据库与开发环境的连接配置。今天要做的就是写一个简单的demo来通过网页操作数据库里面的资源。几个交互的网页那当然是一下子就写完了，代码将会在下面给出。在这次的小实验当中，最令我困惑的就是如何把网页提交的比如说查询的目标参数，传入到JSTL的语句里面来进行查询。为此，我浪费了不少时间，但是要经过一番努力。原来有一种叫做EL（expression language）的东西非常有用。关于这个的详细资料，大家可以参看<a href="http://www.javawind.net/help/html/jstl_el.htm">这里</a>。</p>

<h1 id="准备工作">准备工作</h1>

<p>首先需要建立一个数据库，有关数据库的不在我们的讨论范围之内。相信建立数据库和创建数据表大家都是可以比较轻易的完成的。
其次是建立数据库与开发环境的连接，这里可以参看我的前一篇文章。
最后要提示一下，在使用JSTL库之前需要下载相关的JRE，并将他们放到tomcat的相关目录下，这里也可以参看我的上一篇文章。</p>

<h1 id="代码过程">代码过程</h1>

<p>首先是整个工程的目录架构
<img src="http://img.blog.csdn.net/20150719234110184?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="">
图中可以看到的.jsp文件有四个：</p>

<ul>
<li>index是开始页面，这里提供两个按钮，分别可以进入到查询或者创建的相关页面；</li>
<li>create顾名思义是创建新的数据库条目的文件，下面给出的代码不包含创建，有需要可以自己完成；</li>
<li>query是查询的相关页面，这里我们输入查询的参数，服务器会从数据库当中找到相关的内容，然后返回给用户；</li>
<li>response是服务器的反应，相当于一个servlet，是服务器的逻辑处理部分。只不过这里是用jsp来进行书写，并且使用的JSTL的核心标签和数据库标签；</li>
</ul>

<p>下面给出，最重要的response的代码：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;%--</span> 
    <span class="nx">Document</span>   <span class="o">:</span> <span class="nx">response</span>
    <span class="nx">Created</span> <span class="nx">on</span> <span class="o">:</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="mi">19</span><span class="p">,</span> <span class="mi">14</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">11</span>
    <span class="nx">Author</span>     <span class="o">:</span> <span class="nx">ERIC_LAI</span>
<span class="o">--%&gt;</span>
<span class="o">&lt;%</span><span class="err">@</span><span class="nx">taglib</span> <span class="nx">prefix</span><span class="o">=</span><span class="s2">&quot;sql&quot;</span> <span class="nx">uri</span><span class="o">=</span><span class="s2">&quot;http://java.sun.com/jsp/jstl/sql&quot;</span><span class="o">%&gt;</span>
<span class="o">&lt;%</span><span class="err">@</span> <span class="nx">taglib</span> <span class="nx">prefix</span><span class="o">=</span><span class="s2">&quot;c&quot;</span> <span class="nx">uri</span><span class="o">=</span><span class="s2">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="o">%&gt;</span>
<span class="o">&lt;%</span><span class="err">@</span><span class="nx">page</span> <span class="nx">contentType</span><span class="o">=</span><span class="s2">&quot;text/html&quot;</span> <span class="nx">pageEncoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">%&gt;</span>
<span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">response</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>
    <span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;</span>    
        <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="err">查询结果</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
            <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;color:#ff0000;&quot;</span><span class="o">&gt;</span><span class="c">&lt;!--</span> <span class="nx">JSTL</span><span class="err">的数据库标签，用来处理和数据库相关的内容，这里使用的是查询</span> <span class="o">--&gt;&lt;</span><span class="err">/span&gt;</span>
            <span class="o">&lt;</span><span class="nx">sql</span><span class="o">:</span><span class="nx">query</span> <span class="kd">var</span><span class="o">=</span><span class="s2">&quot;result&quot;</span> <span class="nx">scope</span><span class="o">=</span><span class="s2">&quot;request&quot;</span> <span class="nx">dataSource</span><span class="o">=</span><span class="s2">&quot;jdbc/DbTest&quot;</span><span class="o">&gt;</span>

                <span class="nx">SELECT</span> <span class="o">*</span> <span class="nx">FROM</span> <span class="nx">sendtable</span> <span class="nx">WHERE</span> <span class="nx">rePhone</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">phone</span><span class="p">}</span>
               <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;color:#ff0000;&quot;</span><span class="o">&gt;</span><span class="c">&lt;!--</span> <span class="nx">$</span><span class="p">{</span><span class="nx">param</span><span class="p">.</span><span class="nx">phone</span><span class="p">}</span> <span class="err">这里是整个的关键，使用</span><span class="nx">EL</span><span class="err">将查询页面的请求参数读取出来，给</span><span class="nx">select</span><span class="err">语句使用</span> <span class="o">--&gt;&lt;</span><span class="err">/span&gt;</span>

            <span class="o">&lt;</span><span class="err">/sql:query&gt;</span>

            <span class="o">&lt;</span><span class="nx">table</span> <span class="nx">border</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&quot;60%&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="err">收件人手机</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
                        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="err">收件人地址</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
                        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="err">寄件人手机</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
                        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="err">寄件人地址</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
                        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="nx">id</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
                    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
                <span class="o">&lt;</span><span class="err">/thead&gt;</span>
                <span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">c</span><span class="o">:</span><span class="nx">forEach</span> <span class="kd">var</span><span class="o">=</span><span class="s2">&quot;row&quot;</span> <span class="nx">items</span><span class="o">=</span><span class="s2">&quot;${result.rows}&quot;</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">c</span><span class="o">:</span><span class="nx">out</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;${row.rePhone}&quot;</span><span class="o">/&gt;&lt;</span><span class="err">/td&gt;</span>
                            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">c</span><span class="o">:</span><span class="nx">out</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;${row.reAddress}&quot;</span><span class="o">/&gt;&lt;</span><span class="err">/td&gt;</span>
                            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">c</span><span class="o">:</span><span class="nx">out</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;${row.sePhone}&quot;</span><span class="o">/&gt;&lt;</span><span class="err">/td&gt;</span>
                            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">c</span><span class="o">:</span><span class="nx">out</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;${row.seAddress}&quot;</span><span class="o">/&gt;&lt;</span><span class="err">/td&gt;</span>
                            <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;&lt;</span><span class="nx">c</span><span class="o">:</span><span class="nx">out</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;${row.id}&quot;</span><span class="o">/&gt;&lt;</span><span class="err">/td&gt;</span>
                        <span class="o">&lt;</span><span class="err">/tr&gt;</span>
                    <span class="o">&lt;</span><span class="err">/c:forEach&gt;               </span>
                <span class="o">&lt;</span><span class="err">/tbody&gt;</span>
            <span class="o">&lt;</span><span class="err">/table&gt;</span>
        <span class="o">&lt;</span><span class="err">/body&gt;</span>
    <span class="o">&lt;</span><span class="err">/center&gt;</span>

<span class="o">&lt;</span><span class="err">/html&gt;</span>
</code></pre></div>
<p>下面是index的代码：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;%</span><span class="err">@</span><span class="nx">page</span> <span class="nx">contentType</span><span class="o">=</span><span class="s2">&quot;text/html&quot;</span> <span class="nx">pageEncoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">%&gt;</span>
<span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">DataBase</span> <span class="nx">Test</span> <span class="nx">Welcome</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>
    <span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;</span>  
        <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="err">数据库实验</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>

            <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;我要快递&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;create&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="s2">&quot;window.open(&#39;create.jsp&#39;);&quot;</span><span class="o">/&gt;</span>

             <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;我要查询&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;query&quot;</span> <span class="nx">onClick</span><span class="o">=</span><span class="s2">&quot;window.open(&#39;query.jsp&#39;);&quot;</span><span class="o">/&gt;</span>

        <span class="o">&lt;</span><span class="err">/body&gt;      </span>
    <span class="o">&lt;</span><span class="err">/center&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</code></pre></div>
<p>下面是query的代码，这里使用了表单和http的POST方法将请求参数传到服务器上：</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;%</span><span class="err">@</span><span class="nx">page</span> <span class="nx">contentType</span><span class="o">=</span><span class="s2">&quot;text/html&quot;</span> <span class="nx">pageEncoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">%&gt;</span>
<span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">query</span> <span class="nx">an</span> <span class="nx">iteam</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
    <span class="o">&lt;</span><span class="err">/head&gt;</span>
    <span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="err">查询我的快递</span><span class="o">&lt;</span><span class="err">/h1&gt; </span>
            <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;response.jsp&quot;</span>  <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;query method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;rePhone&quot;</span> <span class="nx">checked</span><span class="o">=</span><span class="s2">&quot;checked&quot;</span> <span class="o">/&gt;</span><span class="err">按照收件人手机查询</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
                <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;query method&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;sePhone&quot;</span>   <span class="o">/&gt;</span><span class="err">按照寄件人手机查询</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
                <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="err">请输入手机号</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;phone&quot;</span> <span class="o">&gt;&lt;</span><span class="err">/p&gt;</span>
                <span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;提交数据&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="err">/form&gt;</span>
        <span class="o">&lt;</span><span class="err">/body&gt;</span>
    <span class="o">&lt;</span><span class="err">/center&gt;</span>

<span class="o">&lt;</span><span class="err">/html&gt;</span>
</code></pre></div>
<p>至此，完成了本次实验。总而言之，最重要的是数据传递的问题，这个问题使用EL可以很容易的解决，现在，基本主流的浏览器都能够支持这个的运行。</p>

    <nav class="pagination-link">
        
        <a class="prev" href="/2015/07/18/mysql-netbean.html" rel="bookmark">&laquo;&nbsp;netbean下部署tomcat服务器连接mysql数据库</a>
        
        
        <a class="next" href="/2015/07/30/sqlite-android.html" rel="bookmark">Android的SQLite数据库存储&nbsp;&raquo;</a>
        
     </nav>
     <div id="disqus_thread"></div>
</article>  

        <center><footer id="foot">
            <p>Copyright © 2015 Eric_Lai All rights reserved.</p>
            <P>This theme template was designed by <a href="http://www.pizn.net" target="_blank" title="the One theme author">PIZn</a>, thanks!</P>
        </footer></center>
    </section>
</div>
<div id="foot-line"></div>
<script src="/js/jquery.js" type="text/javascript"></script>
<script src="/js/jquery.scrollTo.js" type="text/javascript"></script>
<script src="/js/theOne.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    /**
     * disqus
     */
    var disqusId = $("#disqus_thread");
    if(disqusId && typeof disqusId != "undefined" && disqusId.length != 0) {
        var disqusName = "Ericblog";
        var disqus_shortname = disqusName != "" ? disqusName : "piznblog";
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] ||
                document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    }
});
</script>
</body>
</html>
